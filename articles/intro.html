<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Geospatial Networks in R • sfnetworks</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tidy Geospatial Networks in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Tidy Geospatial Networks in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tidy Geospatial Networks in R</h1>
            
            <h4 class="date">2020-04-15</h4>
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>Thanks to active developer and user communities, R is becoming an increasingly popular language for interactive geographic data analysis. Large steps forward include the release and continued evolution of <a href="https://r-spatial.github.io/sf/">sf</a>, which provides classes for representing and manipulating spatial vector data (points, lines and polygons). Unlike its predecessors, <code>sf</code> is compatible with the popular data science oriented packages that form the <a href="https://www.tidyverse.org/">tidyverse</a>, most notably the data manipulation toolbox <code>dplyr</code>, and more generally with the concept of <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a>.</p>
<p>R is also well-suited for network analysis, thanks to the R interface of the <a href="https://igraph.org/">igraph library</a>. The <a href="https://tidygraph.data-imaginist.com/index.html">tidygraph package</a> extends <code>igraph</code> into the domain of the <code>tidyverse</code>, enabling <code>dplyr</code> compatibility by treating a graph as a collection of two tidy data frames describing respectively the nodes and edges.</p>
<p>Given the strength of R in spatial <em>and</em> network analysis, one would expect it to be an ideal language for analysis of geospatial networks. Geospatial networks are simultaneously graph and spatial objects, with nodes and edges embedded in geographic space. Well known examples include transport networks, river basins, power grids, ecological networks and geolocated social networks.</p>
<p>Although several R packages exist that address geospatial networks, they often focus on a specific application within the broader domain of geospatial network analysis, or complicate <code>tidyverse</code> compatibility, for example by using S4 classes or relying on the older <code>sp</code> package for spatial data handling. Hence, at present, no generally applicable, <code>tidyverse</code> compatible classes exist for geospatial network data, representing a gap in R’s spatial and network analysis ecosystems (see the <a href="https://cran.r-project.org/web/views/gR.html">gRaphical Models</a> and <a href="https://cran.r-project.org/web/views/Spatial.html">Spatial</a> task views). <code>sfnetworks</code> is created to fill this gap, and form a connecting edge between the two worlds.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The <code>sfnetworks</code> package is still in very active development, and this vignette only describes the first part of our work. Therefore, the package is also not on CRAN yet. Install it from GitHub using the <code>remotes</code> package in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>remotes<span class="op">::</span><span class="kw"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"luukvdmeer/sfnetworks"</span>)</span></code></pre></div>
</div>
<div id="the-sfnetwork-data-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#the-sfnetwork-data-structure" class="anchor"></a>The sfnetwork data structure</h2>
<p>The core of the <code>sfnetworks</code> package is the <code>sfnetwork</code> data structure. This is a class that subclasses tidygraph’s <code>tbl_graph</code>, which itself subclasses <code>igraph</code>. Therefore, <code>sfnetwork</code> objects are recognized by all network analysis algorithms that <code>igraph</code> offers, as well as by the tidy wrappers that <code>tidygraph</code> has built around them.</p>
<div id="philosophy" class="section level3">
<h3 class="hasAnchor">
<a href="#philosophy" class="anchor"></a>Philosophy</h3>
<p>The philosophy of a <code>tbl_graph</code> is best described by the following paragraph from the tidygraph introduction: “Relational data cannot in any meaningful way be encoded as a single tidy data frame. On the other hand, both node and edge data by itself fits very well within the tidy concept as each node and edge is, in a sense, a single observation. Thus, a close approximation of tidyness for relational data is two tidy data frames, one describing the node data and one describing the edge data.”</p>
<p>Since <code>sfnetwork</code> subclasses <code>tbl_graph</code>, it shares the same philosophy. However, it extends it into the domain of geospatial data analysis, where each observation has a location in geographical space. For that, it brings <code>sf</code> into the game. An <code>sf</code> object stores the geographical coordinates of each observation in standardized format in a geometry list column, which has a Coordinate Reference System associated with it. Thus, in <code>sfnetworks</code>, we re-formulate the last sentence of the paragraph above to the following. “A close approximation of tidyness for relational <em>geospatial data</em> is two <em>sf objects</em>, one describing the node data and one describing the edge data.”</p>
<p>We do need to make a note here. In a geospatial network, the nodes <em>always</em> have coordinates in geographic space, and thus, are always described by an sf object. The edges, however, can also be described by just the indices of its end-nodes. This still makes them geospatial, because they start and end at specific points in space, but the spatial information is not <em>explicitly</em> attached to them. Both representations can be useful. In road networks, for example, it makes sense to explicitly draw a line geometry between two nodes, while in geolocated social networks, it probably does not. An <code>sfnetwork</code> supports both types. It can either have edges with a geometry stored in a geometry list column, described by an sf object, or edges that only refer to node indices, described by a regular data frame. We refer to these types of edges as respectively <em>spatially explicit edges</em> and <em>spatially implicit edges</em>. In this vignette, we mainly focus on the first type.</p>
</div>
<div id="construction" class="section level3">
<h3 class="hasAnchor">
<a href="#construction" class="anchor"></a>Construction</h3>
<p>An <code>sfnetwork</code> object can be constructed with the <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> function. This function expects the nodes and edges data as arguments, meeting the following requirements:</p>
<ul>
<li>The nodes should be an object of class <code>sf</code>, solely containing features with <code>POINT</code> geometries.</li>
<li>When creating a network with spatially explicit edges, the edges should be an object of class <code>sf</code>, solely containing features with <code>LINESTRING</code> geometries. Otherwise, they can be a <code>data.frame</code> or <code>tibble</code>. In any case, they should contain the indices of their end-nodes in a to and from column, or in the two first columns, as integers. Every node index refers to the <em>position</em> (i.e. the rownumber) of the node in the nodes table.</li>
<li>When creating a network with spatially explicit edges, the coordinates of the endpoints of the edge linestrings should match with the coordinates of the respective end-nodes. Otherwise, the network structure is not valid.</li>
<li>When creating a network with spatially explicit edges, the two provided sf objects should have the same CRS.</li>
</ul>
<p>Additionally, one can set the <code>directed</code> argument, defining if the created network should be directed or not. This defaults to <code>TRUE</code>.</p>
<p>See below a small toy example.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sfnetworks)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sf)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidygraph)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>p1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>, <span class="dv">51</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a>p2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>, <span class="dv">52</span>))</span>
<span id="cb3-3"><a href="#cb3-3"></a>p3 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">8</span>, <span class="dv">52</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a>nodes =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(p1, p2, p3, <span class="dt">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>e1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_combine.html">st_union</a></span>(p1,p2), <span class="st">"LINESTRING"</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>e2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_combine.html">st_union</a></span>(p1,p3), <span class="st">"LINESTRING"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>e3 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_combine.html">st_union</a></span>(p2,p3), <span class="st">"LINESTRING"</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>edges =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(e1, e2, e3, <span class="dt">crs =</span> <span class="dv">4326</span>))</span>
<span id="cb3-10"><a href="#cb3-10"></a>edges<span class="op">$</span>from =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a>edges<span class="op">$</span>to =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw"><a href="../reference/sfnetwork.html">sfnetwork</a></span>(nodes, edges, <span class="dt">directed =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected simple graph with 1 component</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52)
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     3 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2     (7 51, 7 52)
#&gt; </span><span style="color: #555555;">2</span><span>     1     3     (7 51, 8 52)
#&gt; </span><span style="color: #555555;">3</span><span>     2     3     (7 52, 8 52)
</span></code></pre>
<p>Converting foreign objects into an <code>sfnetwork</code> can be done with the <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> function. Every object that fulfills both of the following requirements is supported by default:</p>
<ul>
<li>The object is a <code>tbl_graph</code> or convertible to a <code>tbl_graph</code> with <code><a href="https://rdrr.io/pkg/tidygraph/man/tbl_graph.html">as_tbl_graph()</a></code>. See the <a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html">tidygraph documentation</a> for all objects that are supported.</li>
<li>At least the nodes are convertible to an <code>sf</code> object with <code><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf()</a></code>.</li>
</ul>
<p>Additionally, <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> has a method that directly converts an <code>sf</code> object into a network. Of course, a single <code>sf</code> object does not contain any explicit network information, so assumptions have to made. This functionality should therefore be seen as a convenience function, and will not be suited for all possible use-cases. It works as follows:</p>
<ul>
<li>When given an <code>sf</code> object with <code>LINESTRING</code> geometries: the lines are considered edges, and nodes are created at the endpoints of the lines. Identical endpoints become one single node. This addresses the use-case that was presented in this <a href="https://www.r-spatial.org/r/2019/09/26/spatial-networks.html">r-spatial blogpost</a>.</li>
<li>When given an <code>sf</code> object with <code>POINT</code> geometries: the points are considered nodes, and edges are created between them, in a sequential way. With that we mean: node 1 will be connected to node 2, node 2 to node 3, et cetera. This addresses the use-case that was presented in this <a href="https://stackoverflow.com/questions/57833905/how-to-convert-a-list-of-sf-spatial-points-into-a-routable-graph">stackoverflow thread</a>.</li>
</ul>
<p>See below an example with the Roxel dataset (which comes with <code>sfnetworks</code> and is a cleaned extract of OpenStreetMap roads in Münster-Roxel).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>roxel</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 851 features and 2 fields
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
#&gt; CRS:            EPSG:4326
#&gt; <span style="color: #555555;"># A tibble: 851 x 3</span><span>
#&gt;    name           type                                                  geometry
#&gt;    </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;"> 1</span><span> Havixbecker S… residen…                (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;"> 2</span><span> Pienersallee   seconda… (7.532442 51.95422, 7.53236 51.95377, 7.53209 51.953…
#&gt; </span><span style="color: #555555;"> 3</span><span> Schulte-Bernd… residen… (7.532709 51.95209, 7.532823 51.95239, 7.532869 51.9…
#&gt; </span><span style="color: #555555;"> 4</span><span> </span><span style="color: #BB0000;">NA</span><span>             path     (7.540063 51.94468, 7.539696 51.94479, 7.539466 51.9…
#&gt; </span><span style="color: #555555;"> 5</span><span> Welsingheide   residen…                 (7.537673 51.9475, 7.537614 51.94562)
#&gt; </span><span style="color: #555555;"> 6</span><span> </span><span style="color: #BB0000;">NA</span><span>             footway  (7.543791 51.94733, 7.54369 51.94686, 7.543751 51.94…
#&gt; </span><span style="color: #555555;"> 7</span><span> </span><span style="color: #BB0000;">NA</span><span>             footway                  (7.54012 51.94478, 7.539931 51.94514)
#&gt; </span><span style="color: #555555;"> 8</span><span> </span><span style="color: #BB0000;">NA</span><span>             path     (7.53822 51.94546, 7.538131 51.94549, 7.538027 51.94…
#&gt; </span><span style="color: #555555;"> 9</span><span> </span><span style="color: #BB0000;">NA</span><span>             track    (7.540063 51.94468, 7.540338 51.94468, 7.540591 51.9…
#&gt; </span><span style="color: #555555;">10</span><span> </span><span style="color: #BB0000;">NA</span><span>             track    (7.5424 51.94599, 7.54205 51.94629, 7.541967 51.9463…
#&gt; </span><span style="color: #555555;"># … with 841 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>(<span class="dt">net =</span> <span class="kw"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span>(roxel, <span class="dt">directed =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576)
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422)
#&gt; </span><span style="color: #555555;">4</span><span>  (7.53209 51.95328)
#&gt; </span><span style="color: #555555;">5</span><span> (7.532709 51.95209)
#&gt; </span><span style="color: #555555;">6</span><span> (7.532869 51.95257)
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name           type                                       geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                              </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker S… residen…     (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee   seconda… (7.532442 51.95422, 7.53236 51.95377, 7.5…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd… residen… (7.532709 51.95209, 7.532823 51.95239, 7.…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(net)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; [1] "sfnetwork" "tbl_graph" "igraph"</span></span></code></pre></div>
<p>More methods will be added in the near future, such that other spatial network objects that exist in R can be directly converted into an <code>sfnetwork</code>, e.g. <code>dodgr_streetnet</code> from the <code>dodgr</code> package and <code>SpatialLinesNetwork</code> from the <code>stplanr</code> package.</p>
</div>
<div id="activation-and-extraction" class="section level3">
<h3 class="hasAnchor">
<a href="#activation-and-extraction" class="anchor"></a>Activation and extraction</h3>
<p>Just as with a <code>tbl_graph</code>, one of the graph elements of an <code>sfnetwork</code> (i.e. nodes or edges) can be activated, and all subsequent computations will be performed on that active element. By default, the nodes are the active element. This can be changed with the <code><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate()</a></code> verb, that is borrowed from <code>tidygraph</code>.</p>
<p>Thanks to <code><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate()</a></code>, a lot of data manipulation tools can be directly applied to the network. If you want to do something that goes further, you can always extract the active element as an <code>sf</code> object, simply by calling <code><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf()</a></code> - in the case of spatially implicit edges, extract them with <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code> instead.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>net <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>()</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 851 features and 4 fields
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
#&gt; CRS:            EPSG:4326
#&gt; <span style="color: #555555;"># A tibble: 851 x 5</span><span>
#&gt;     from    to name         type                                        geometry
#&gt;    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                               </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;"> 1</span><span>     1     2 Havixbecker… reside…       (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;"> 2</span><span>     3     4 Pienersallee second… (7.532442 51.95422, 7.53236 51.95377, 7.532…
#&gt; </span><span style="color: #555555;"> 3</span><span>     5     6 Schulte-Ber… reside… (7.532709 51.95209, 7.532823 51.95239, 7.53…
#&gt; </span><span style="color: #555555;"> 4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>           path    (7.540063 51.94468, 7.539696 51.94479, 7.53…
#&gt; </span><span style="color: #555555;"> 5</span><span>     9    10 Welsingheide reside…        (7.537673 51.9475, 7.537614 51.94562)
#&gt; </span><span style="color: #555555;"> 6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>           footway (7.543791 51.94733, 7.54369 51.94686, 7.543…
#&gt; </span><span style="color: #555555;"> 7</span><span>    13    14 </span><span style="color: #BB0000;">NA</span><span>           footway        (7.54012 51.94478, 7.539931 51.94514)
#&gt; </span><span style="color: #555555;"> 8</span><span>     8    10 </span><span style="color: #BB0000;">NA</span><span>           path    (7.53822 51.94546, 7.538131 51.94549, 7.538…
#&gt; </span><span style="color: #555555;"> 9</span><span>     7    15 </span><span style="color: #BB0000;">NA</span><span>           track   (7.540063 51.94468, 7.540338 51.94468, 7.54…
#&gt; </span><span style="color: #555555;">10</span><span>    16    17 </span><span style="color: #BB0000;">NA</span><span>           track   (7.5424 51.94599, 7.54205 51.94629, 7.54196…
#&gt; </span><span style="color: #555555;"># … with 841 more rows</span><span>
</span></code></pre>
</div>
<div id="visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h3>
<p>The <code>sfnetworks</code> package does not (yet?) include advanced visualization options. However, a simple plot method is provided, which gives a quick view of how the network looks like.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(net)</span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>For advanced visualization, we encourage to extract nodes and edges as <code>sf</code> objects, and use one of the many ways to map those in R, either statically or interactively. Think of sf’s default plot method, ggplots <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>, <code>tmap</code>, <code>mapview</code>, et cetera.</p>
</div>
</div>
<div id="graph-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#graph-operations" class="anchor"></a>Graph operations</h2>
<p>Since it subclasses <code>tbl_graph</code>, <code>sfnetwork</code> objects are recognized by all network analysis algorithms that <code>igraph</code> offers, as well as by the tidy wrappers that <code>tidygraph</code> has built around them.</p>
<p>A small example is the calculation of the betweenness centrality for each node:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>net_c =<span class="st"> </span>net <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"nodes"</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">mutate</a></span>(<span class="dt">bc =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/centrality.html">centrality_betweenness</a></span>())</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(net_c, <span class="st">"edges"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(), <span class="dt">col =</span> <span class="st">'grey50'</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(net_c, <span class="st">"nodes"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(), <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">col =</span> bc, <span class="dt">size =</span> bc))</span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<p>There is a large amount of available algorithms, ranging from simple type queries to advanced community detection. To keep this vignette within an acceptable length, we will not cover all graph algorithms that can be used, but instead refer to the <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/">tidygraph introduction</a>.</p>
</div>
<div id="spatial-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-operations" class="anchor"></a>Spatial operations</h2>
<p>Not only can <code>sfnetwork</code> objects be used in graph algorithms, they are also recognized by various spatial analytical functions of <code>sf</code>. Internally, this works as follows: the active element is converted to an <code>sf</code> object, on which the function is applied. Depending on the function, the results are merged back into the network, and an <code>sfnetwork</code> object is returned, or simply the raw output of the sf function is returned.</p>
<p>Some of the functions have effects also outside of the active element: when nodes are removed from the network, the edges terminating at those nodes will be removed too. This behavior is <em>not</em> symmetric: when removing edges, the nodes that are at the start or end of those edges remain, even if they are not adjacent to any other edge. This is because in graph theory, edges can never exist without end-nodes, while nodes can exist without having adjacent edges.</p>
<p>All supported <code>sf</code> functions that are of the form <code>f(x,y)</code> also accept an <code>sfnetwork</code> as <code>y</code> parameter. Just as for object <code>x</code>, the active element of the network <code>y</code> will internally be converted to an <code>sf</code> object, and used as such inside the function.</p>
<div id="spatial-filters" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-filters" class="anchor"></a>Spatial filters</h3>
<p>Networks can be filtered by a <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">spatial predicate</a>, using <code>st_filter</code>. For example, we want to only keep those nodes that intersect with a given polygon:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>p1 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53173</span>, <span class="fl">51.95662</span>))</span>
<span id="cb10-2"><a href="#cb10-2"></a>p2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53173</span>, <span class="fl">51.95190</span>))</span>
<span id="cb10-3"><a href="#cb10-3"></a>p3 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53778</span>, <span class="fl">51.95190</span>))</span>
<span id="cb10-4"><a href="#cb10-4"></a>p4 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53778</span>, <span class="fl">51.95662</span>))</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a>rect =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_multipoint</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(p1, p2, p3, p4)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="st">'POLYGON'</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb10-9"><a href="#cb10-9"></a></span>
<span id="cb10-10"><a href="#cb10-10"></a>net_f =<span class="st"> </span>net <span class="op">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_join.html">st_filter</a></span>(rect, <span class="dt">.pred =</span> st_intersects)</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(net)</span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(rect, <span class="dt">border =</span> <span class="st">"Red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(net_f)</span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="intro_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
<div id="spatial-joins" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-joins" class="anchor"></a>Spatial joins</h3>
<p>Additional attributes can be joined spatially into the network with <code>st_join</code>, which is also based on spatial predicates. By default, this join is a left join, meaning that all features (i.e. nodes or edges) of <code>x</code> remain. If changed to a inner join (by adding <code>left = FALSE</code>), features get removed if they don’t have a match with any row in <code>y</code>.</p>
<p>The <code>sfnetwork</code> method for <code>st_join</code> has an important restriction. When the nodes are the active element of the network, only joins where there is at most one match per feature are allowed. Allowing multiple matches is a problem when joining on the nodes. For example, if node 1 in <code>x</code> has two matches in <code>y</code>, this creates two rows for node 1 in the resulting object. Firstly, this messes up the network structure: if the end-nodes of edge A where node 1 and node 2, these indices now suddenly refer to the same node, while the original node 2 became node 3. Secondly, if we manage to update the <code>from</code> and <code>to</code> columns of the edges accordingly, should edge A go from the new node 1 to the new node 3, or from the new node 2 to the new node 3? In the future we might remove the restriction, but only after we decide on a good way to deal with multiple matches per node.</p>
<p>For the edges this problem does not exist, because the same nodes can be connected by multiple edges. Multiple matches will cause edges to be duplicated, which might not be so useful, but at least it does not break the network structure.</p>
<p>An example of a spatial join:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>net_a =<span class="st"> </span>net <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">slice</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>net_b =<span class="st"> </span>net <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">slice</a></span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">mutate</a></span>(<span class="dt">foo =</span> <span class="st">"bar"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>net_a <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_join.html">st_join</a></span>(net_b, <span class="dt">join =</span> st_equals)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">1</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected simple graph with 2 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.532442 ymin: 51.95422 xmax: 7.533722 ymax: 51.95576</span><span>
#&gt;              geometry foo  
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556) </span><span style="color: #BB0000;">NA</span><span>   
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576) bar  
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422) bar  
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     1 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.533461 ymin: 51.95556 xmax: 7.533722 ymax: 51.95576</span><span>
#&gt;    from    to name               type                                   geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                          </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker Stras… residenti… (7.533722 51.95556, 7.533461 51.955…
</span></code></pre>
</div>
<div id="using-spatial-predicates-directly" class="section level3">
<h3 class="hasAnchor">
<a href="#using-spatial-predicates-directly" class="anchor"></a>Using spatial predicates directly</h3>
<p>Spatial predicates are very useful for filtering and joining, but can also directly be applied to an <code>sfnetwork</code>. This allows for example to create new attribute columns based on such predicates.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>net <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">mutate</a></span>(<span class="dt">in_rect =</span> <span class="kw"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_binary_pred.html">st_intersects</a></span>(., rect)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry in_rect
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556) TRUE   
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576) TRUE   
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422) TRUE   
#&gt; </span><span style="color: #555555;">4</span><span>  (7.53209 51.95328) TRUE   
#&gt; </span><span style="color: #555555;">5</span><span> (7.532709 51.95209) TRUE   
#&gt; </span><span style="color: #555555;">6</span><span> (7.532869 51.95257) TRUE   
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name           type                                       geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                              </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker S… residen…     (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee   seconda… (7.532442 51.95422, 7.53236 51.95377, 7.5…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd… residen… (7.532709 51.95209, 7.532823 51.95239, 7.…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
</div>
<div id="setting-or-transforming-crs" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-or-transforming-crs" class="anchor"></a>Setting or transforming CRS</h3>
<p>Also the CRS functions technically are applied to the active element of the network. However, when changing the CRS of the active element (either by setting or transforming), the same operation is applied to the other element (of course this does not apply for spatially implicit edges). This is because <code>sfnetwork</code> objects have the restriction that nodes and edges should always be in the same CRS.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(net)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">#&gt;   User input: EPSG:4326 </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">#&gt; GEOGCS["WGS 84",</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt;     DATUM["WGS_1984",</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt;         SPHEROID["WGS 84",6378137,298.257223563,</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt;             AUTHORITY["EPSG","7030"]],</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt;         AUTHORITY["EPSG","6326"]],</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt;         AUTHORITY["EPSG","8901"]],</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt;     UNIT["degree",0.0174532925199433,</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt;         AUTHORITY["EPSG","9122"]],</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt;     AUTHORITY["EPSG","4326"]]</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(net, <span class="dv">3035</span>)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
</div>
<div id="setting-or-replacing-geometries" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-or-replacing-geometries" class="anchor"></a>Setting or replacing geometries</h3>
<p>Replacing the geometry of nodes or edges comes with restrictions. First, there is for now a general restriction for <code>sfnetwork</code> objects that nodes can only be points, and edges (if spatially explicit) only lines. This is to keep things simple at first. If there are use-cases where other geometry types as nodes or edges make sense, we can always loosen this restriction further down the road.</p>
<p>Additionally:</p>
<ul>
<li>You cannot replace the geometry of the nodes when edges are spatially explicit. This would mean that the coordinates of the nodes don’t match anymore with the endpoints of the edges. Hence, the network structure is broken.</li>
<li>You can only replace the geometry of spatially explicit edges when 1) the CRS of the geometries doesn’t change (otherwise you would create a network with different CRS for nodes and edges, which is restricted) and 2) the endpoints of the geometries don’t change (otherwise you would have endpoints of edges that don’t match the node coordinates anymore, and thus break the network structure).</li>
</ul>
<p>Geometries can replaced also by using <a href="https://r-spatial.github.io/sf/reference/geos_unary.html">geometry unary operations</a>, as long as they don’t break the restrictions mentioned above. This basically means that only <code>st_reverse</code> and <code>st_simplify</code> are supported. When calling <code>st_reverse</code> on the edges of a directed network, not only the geometries will be reversed, but the <code>to</code> and <code>from</code> columns of the edges will also be swapped. In the case of undirected networks the geometries are not reversed at all.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(net)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; Geometry set for 701 features </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt; geometry type:  POINT</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; bbox:           xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; CRS:            EPSG:4326</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; First 5 geometries:</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt; POINT (7.533722 51.95556)</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt; POINT (7.533461 51.95576)</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt; POINT (7.532442 51.95422)</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; POINT (7.53209 51.95328)</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt; POINT (7.532709 51.95209)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_set_geometry</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(net, <span class="st">"nodes"</span>), <span class="ot">NULL</span>))</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; [1] "tbl_graph" "igraph"</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_set_geometry</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(net, <span class="st">"edges"</span>), <span class="ot">NULL</span>))</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co">#&gt; [1] "sfnetwork" "tbl_graph" "igraph"</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span>(roxel, <span class="dt">directed =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">st_reverse</a></span>()</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; Warning in st_reverse.sfnetwork(.): Reversing edges swaps columns 'to' and</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; 'from'</span></span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># A directed multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 5 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name         type                                         geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                                </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     2     1 Havixbecker… reside…        (7.533461 51.95576, 7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span>     4     3 Pienersallee second… (7.53209 51.95328, 7.53236 51.95377, 7.53244…
#&gt; </span><span style="color: #555555;">3</span><span>     6     5 Schulte-Ber… reside… (7.532869 51.95257, 7.532823 51.95239, 7.532…
#&gt; </span><span style="color: #555555;">4</span><span>     8     7 </span><span style="color: #BB0000;">NA</span><span>           path    (7.53822 51.94546, 7.538353 51.94542, 7.5385…
#&gt; </span><span style="color: #555555;">5</span><span>    10     9 Welsingheide reside…         (7.537614 51.94562, 7.537673 51.9475)
#&gt; </span><span style="color: #555555;">6</span><span>    12    11 </span><span style="color: #BB0000;">NA</span><span>           footway (7.543751 51.94677, 7.54369 51.94686, 7.5437…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576)
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422)
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
</div>
<div id="computing-geometric-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#computing-geometric-measures" class="anchor"></a>Computing geometric measures</h3>
<p>Geometric measures can be very useful to add as attributes to features, and serve as weights in for example shortest path calculations.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>net_t =<span class="st"> </span>net <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="dv">3035</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">mutate</a></span>(<span class="dt">length =</span> <span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_length</a></span>(.))</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>net_t</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name       type                                  geometry   length
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>      </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbeck… reside…     (4151491 3207923, 4151474 3207946)  28.859…
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersal… second… (4151398 3207777, 4151390 3207727, 41… 107.714…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-B… reside… (4151408 3207539, 4151417 3207573, 41…  54.367…
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>         path    (4151885 3206698, 4151861 3206711, 41… 155.223…
#&gt; </span><span style="color: #555555;">5</span><span>     9    10 Welsinghe… reside…     (4151732 3207017, 4151721 3206809) 208.682…
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>         footway (4152152 3206984, 4152143 3206932, 41…  63.028…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(igraph)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="kw"><a href="https://rdrr.io/pkg/igraph/man/distances.html">shortest_paths</a></span>(net_t, <span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">pull</a></span>(net_t, length))<span class="op">$</span>vpath</span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">#&gt; + 18/701 vertices, from 355f1f4:</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">#&gt;  [1]   1 645 481 263 164 208 426 424 533 657 512 506 111 524 292 167   9  10</span></span></code></pre></div>
</div>
<div id="non-supported-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#non-supported-functions" class="anchor"></a>Non-supported functions</h3>
<p>For the same reason as <code>tidygraph</code> does not support all <code>dplyr</code> functions, <code>sfnetwork</code> does not support all <code>sf</code> functions: there is a clear limitation in the relational data structure that requires rows to maintain their identity. For <code>sfnetwork</code> objects, this also means that the geometries of features should be maintained, or at least the endpoints of these geometries, in the case of the edges. That is, functions that summarise geometries, or (may) change their <em>type</em>, <em>shape</em> or <em>position</em>, are not supported. These are the <a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">geometric binary operations</a>, most of the <a href="https://r-spatial.github.io/sf/reference/geos_unary.html">geometric unary operations</a>, <code>st_union</code>, <code>st_combine</code>, <code>st_cast</code>, <code>st_nearest_point</code>, <code>st_sample</code>, <code>st_line_sample</code>, <code>st_jitter</code>, <code>st_collection_extract</code> and <code>st_make_valid</code>.</p>
<p>These functions cannot be directly applied to an <code>sfnetwork</code> object, but of course you can always escape the network structure, do some work, and merge changes back into the network. For example, when you want to know the area of the voronoi polygon of each node:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>y =<span class="st"> </span>net_t <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"nodes"</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">mutate</a></span>(<span class="dt">aoi =</span> <span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_area</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_collection_extract.html">st_collection_extract</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">st_voronoi</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(c, <span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(.))))))</span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>net_t <span class="op">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"nodes"</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_join.html">st_join</a></span>(y)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry      aoi
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923) 1</span><span style="text-decoration: underline;">837</span><span>540.
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946) 2</span><span style="text-decoration: underline;">563</span><span>698.
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)   </span><span style="text-decoration: underline;">36</span><span>462.
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)  </span><span style="text-decoration: underline;">359</span><span>624.
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)   </span><span style="text-decoration: underline;">12</span><span>954.
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)   </span><span style="text-decoration: underline;">11</span><span>089.
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 6</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name         type                                geometry   length
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                       </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker… residen…  (4151491 3207923, 4151474 3207946)  28.859…
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee seconda… (4151398 3207777, 4151390 3207727,… 107.714…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Ber… residen… (4151408 3207539, 4151417 3207573,…  54.367…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
<p>In addition to those functions mentioned above, there are also no <code>sfnetwork</code> methods for:</p>
<ul>
<li>All functions related to reading and writing data. Use <code>sf</code> for this, and then convert to an <code>sfnetwork</code>. Note: Maybe there are specific spatial network data formats that the package should be able to read from and write to? If yes, please let us know.</li>
<li>All functions related to M and Z coordinates. This is something for later.</li>
<li>Functions that retrieve/change the attributes of sf objects. Like <code>st_agr</code>. See <a href="https://github.com/luukvdmeer/sfnetworks/issues/24">this issue</a>.</li>
</ul>
</div>
</div>
<div id="tidyverse-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#tidyverse-methods" class="anchor"></a>Tidyverse methods</h2>
<p>As already shown in some of the examples above, a lot of <code>dplyr</code> functions work directly on <code>sfnetwork</code> objects, thanks to <code>tidygraph</code>. Since the active elements (if spatially explicit) are internally handled as being <code>sf</code> objects, automatically the <code>sf</code> methods for these functions are used. That means, for example, that the <code>geometry</code> column is ‘sticky’. Note: also the <code>to</code> and <code>from</code> column in the edges table are sticky, which does not come from <code>sf</code>, but from <code>tidygraph</code>. So now, we have three sticky columns!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>net <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="op">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidygraph/man/reexports.html">select</a></span>(name)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #</span><span>
#&gt; </span><span style="color: #555555;"># An undirected multigraph with 14 components</span><span>
#&gt; </span><span style="color: #555555;"># and spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 4 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name                                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker S…              (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee   (7.532442 51.95422, 7.53236 51.95377, 7.53209 51.9…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd… (7.532709 51.95209, 7.532823 51.95239, 7.532869 51…
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>             (7.540063 51.94468, 7.539696 51.94479, 7.539466 51…
#&gt; </span><span style="color: #555555;">5</span><span>     9    10 Welsingheide                 (7.537673 51.9475, 7.537614 51.94562)
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>             (7.543791 51.94733, 7.54369 51.94686, 7.543751 51.…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576)
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422)
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
</div>
<div id="what-is-still-to-come" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-still-to-come" class="anchor"></a>What is still to come?</h2>
<p>Everything presented in this vignette is only a first glance at what <code>sfnetworks</code> will offer. The package is currently in very active development, and several features are planned to be introduced soon.</p>
<div id="better-tidygraph-integration" class="section level3">
<h3 class="hasAnchor">
<a href="#better-tidygraph-integration" class="anchor"></a>Better tidygraph integration</h3>
<p>The fact that <code>sfnetwork</code> subclasses <code>tbl_graph</code>, makes that they are recognized by all of <code>tidygraphs</code> functions. However, not all of these functions already run without errors. This is because of the geometry list column, which causes some operations to fail. Examples are the <code>morph</code> and <code>bind</code> functionalities. These issues should be solved, such that the integration of <code>sfnetworks</code> with <code>tidygraph</code> becomes - approximately - flawless.</p>
</div>
<div id="extending-the-functionalites-of-tidygraph-and-sf" class="section level3">
<h3 class="hasAnchor">
<a href="#extending-the-functionalites-of-tidygraph-and-sf" class="anchor"></a>Extending the functionalites of tidygraph and sf</h3>
<p>Right now, <code>sfnetworks</code> serves as a connection between <code>tidygraph</code> and <code>sf</code>, in the sense that objects of class <code>sfnetwork</code> are recognized by functions of both packages. However, there might be problems that are so specific to spatial networks, that they can neither be solved by <code>tidygraph</code> nor <code>sf</code>. It is the goal of <code>sfnetworks</code> to provide analytical functions by itself, that address such problems. Think of snapping spatial points to the edges of a network, or finding the nearest node to a given spatial feature. We want to prevent that <code>sfnetworks</code> goes too much into a single application - it should remain a lower-level package - but basic, widely used spatial network operations should be supported.</p>
</div>
<div id="adding-more-methods-to-as_sfnetwork" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-more-methods-to-as_sfnetwork" class="anchor"></a>Adding more methods to as_sfnetwork</h3>
<p>As said before, it is the goal to provide <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code>-methods for a wide range of R classes for spatial networks.</p>
</div>
<div id="visualization-1" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-1" class="anchor"></a>Visualization</h3>
<p>In the current version of <code>sfnetworks</code>, visualization of spatial networks does not yet play a big role. It would be great to see this change in the future, for example by good integration with <code>ggraph</code>. Contributions are very welcome regarding this!</p>
</div>
</div>
<div id="contribute" class="section level2">
<h2 class="hasAnchor">
<a href="#contribute" class="anchor"></a>Contribute</h2>
<p>We look very much forward to contributions to the package. This can be in the form of pull requests (please direct them to the <code>develop</code> branch), but also by opening issues in the <a href="https://github.com/luukvdmeer/sfnetworks/issues">issue tracker</a>. Such issues can be specific feature requests labeled with the <code>feature</code> label (e.g. “I would like to see a function <code>f(x)</code> that accepts an object <code>x</code> of class <code>foo</code> and returns &lt; this &gt;”). It can also be a more generic description of problems that you deal with when working with spatial networks in R (e.g. “I usually find it impossible/confusing/complicated to do &lt; this &gt;”). Please label such issues with the <code>hackathon</code> label, since we will be organising a spatial networks hackathon in which we hope to solve these kind of problems. For more information on that event, see <a href="https://www.eventbrite.co.uk/e/erum2020-satellite-event-hackathon-on-spatial-networks-tickets-90976873277">here</a> (and join!).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#the-sfnetwork-data-structure">The sfnetwork data structure</a></li>
      <li><a href="#graph-operations">Graph operations</a></li>
      <li><a href="#spatial-operations">Spatial operations</a></li>
      <li><a href="#tidyverse-methods">Tidyverse methods</a></li>
      <li><a href="#what-is-still-to-come">What is still to come?</a></li>
      <li><a href="#contribute">Contribute</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas van der Meer, Andrea Gilardi, Lorena Abad, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
